CREATE DATABASE etec_food;
Use etec_food;

CREATE TABLE FormaPagamento (
    id BIGINT PRIMARY KEY IDENTITY,
    nome VARCHAR(100) NOT NULL,
    tipo VARCHAR(20) NOT NULL,
    CONSTRAINT CK_FormaPagamento_Tipo CHECK (tipo IN ('CARTAO_CREDITO','CARTAO_DEBITO','VALE_REFEICAO'))
);

CREATE TABLE Usuario (
    id BIGINT PRIMARY KEY IDENTITY,
    nome VARCHAR(150) NOT NULL,
    senha VARCHAR(200) NOT NULL,
    tentativasAcesso INT DEFAULT 0,
    dataBloqueio DATETIME NULL,
    dataInativacao DATETIME NULL,
    status VARCHAR(20) NOT NULL,
    CONSTRAINT CK_Usuario_Status CHECK (status IN ('ATIVO','INATIVO','BLOQUEADO'))
);

CREATE TABLE Permissao (
    authority VARCHAR(100) PRIMARY KEY
);

-- Tabela de relacionamento Usuario x Permissao (N:N)
CREATE TABLE Usuario_Permissao (
    usuario_id BIGINT NOT NULL,
    authority VARCHAR(100) NOT NULL,
    PRIMARY KEY (usuario_id, authority),
    FOREIGN KEY (usuario_id) REFERENCES Usuario(id),
    FOREIGN KEY (authority) REFERENCES Permissao(authority)
);

CREATE TABLE Restaurante (
    id BIGINT PRIMARY KEY IDENTITY,
    cnpj VARCHAR(20) UNIQUE NOT NULL,
    nome VARCHAR(150) NOT NULL,
    descricao VARCHAR(500),
    cep VARCHAR(15),
    endereco VARCHAR(200),
    taxaDeEntrega DECIMAL(10,2),
    tempoDeEntregaMinimo INT,
    tempoDeEntregaMaximo INT,
    aprovado BIT DEFAULT 0,
    tipoDeCozinha VARCHAR(20) NOT NULL,
    usuario_id BIGINT NOT NULL,
    FOREIGN KEY (usuario_id) REFERENCES Usuario(id),
    CONSTRAINT CK_Restaurante_TipoCozinha CHECK (
        tipoDeCozinha IN ('CHINESA','JAPONESA','MEXICANA','MINEIRA','BAIANA',
                          'LANCHES','HAMBURGER','ARABE','ITALIANA','VARIADA')
    )
);

CREATE TABLE HorarioFuncionamento (
    id BIGINT PRIMARY KEY IDENTITY,
    diaSemana VARCHAR(10) NOT NULL,
    horarioAbertura TIME NOT NULL,
    horarioFechamento TIME NOT NULL,
    restaurante_id BIGINT NOT NULL,
    FOREIGN KEY (restaurante_id) REFERENCES Restaurante(id)
);

CREATE TABLE Cardapio (
    id BIGINT PRIMARY KEY IDENTITY,
    restaurante_id BIGINT NOT NULL,
    FOREIGN KEY (restaurante_id) REFERENCES Restaurante(id)
);

CREATE TABLE ItemCardapio (
    id BIGINT PRIMARY KEY IDENTITY,
    nome VARCHAR(100) NOT NULL,
    descricao VARCHAR(255),
    tipo VARCHAR(20) NOT NULL,
    preco DECIMAL(10,2) NOT NULL,
    precoPromocional DECIMAL(10,2),
    cardapio_id BIGINT NOT NULL,
    FOREIGN KEY (cardapio_id) REFERENCES Cardapio(id),
    CONSTRAINT CK_ItemCardapio_Tipo CHECK (tipo IN ('ENTRADA','PRATO_PRINCIPAL','BEBIDA'))
);

CREATE TABLE Cliente (
    id BIGINT PRIMARY KEY IDENTITY,
    nome VARCHAR(150) NOT NULL,
    cpf VARCHAR(14) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    telefone VARCHAR(20),
    validado BIT DEFAULT 0
);

CREATE TABLE Pedido (
    id BIGINT PRIMARY KEY IDENTITY,
    data DATETIME NOT NULL,
    status VARCHAR(20) NOT NULL,
    restaurante_id BIGINT NOT NULL,
    FOREIGN KEY (restaurante_id) REFERENCES Restaurante(id),
    CONSTRAINT CK_Pedido_Status CHECK (
        status IN ('REALIZADO','PAGO','CONFIRMADO','PRONTO','SAIU_PARA_ENTREGA','ENTREGUE')
    )
);


CREATE TABLE ItemPedido (
    id BIGINT PRIMARY KEY IDENTITY,
    quantidade INT NOT NULL,
    observacao VARCHAR(255),
    pedido_id BIGINT NOT NULL,
    itemCardapio_id BIGINT NOT NULL,
    FOREIGN KEY (pedido_id) REFERENCES Pedido(id),
    FOREIGN KEY (itemCardapio_id) REFERENCES ItemCardapio(id)
);

CREATE TABLE Pagamento (
    id BIGINT PRIMARY KEY IDENTITY,
    valor DECIMAL(10,2) NOT NULL,
    nome VARCHAR(100),
    numero VARCHAR(30),
    expiracao VARCHAR(10),
    codigo VARCHAR(10),
    status VARCHAR(20) NOT NULL,
    pedido_id BIGINT NOT NULL,
    formaPagamento_id BIGINT NOT NULL,
    FOREIGN KEY (pedido_id) REFERENCES Pedido(id),
    FOREIGN KEY (formaPagamento_id) REFERENCES FormaPagamento(id),
    CONSTRAINT CK_Pagamento_Status CHECK (status IN ('CRIADO','CONFIRMADO','CANCELADO'))
);

CREATE TABLE RestauranteFormaPagamento (
    restaurante_id BIGINT NOT NULL,
    formaPagamento_id BIGINT NOT NULL,
    PRIMARY KEY (restaurante_id, formaPagamento_id),
    FOREIGN KEY (restaurante_id) REFERENCES Restaurante(id),
    FOREIGN KEY (formaPagamento_id) REFERENCES FormaPagamento(id)
);

CREATE TABLE Avaliacao (
    id BIGINT PRIMARY KEY IDENTITY,
    nota INT NOT NULL CHECK (nota BETWEEN 1 AND 5),
    comentario VARCHAR(255),
    pedido_id BIGINT NOT NULL,
    FOREIGN KEY (pedido_id) REFERENCES Pedido(id)
);

CREATE TABLE Entregador (
    id BIGINT PRIMARY KEY IDENTITY,
    nome VARCHAR(150) NOT NULL,
    telefone VARCHAR(20),
    ativo BIT DEFAULT 1
);

CREATE TABLE Veiculo (
    id BIGINT PRIMARY KEY IDENTITY,
    placa VARCHAR(10) UNIQUE NOT NULL,
    tipo VARCHAR(20) NOT NULL,
    entregador_id BIGINT NOT NULL,
    FOREIGN KEY (entregador_id) REFERENCES Entregador(id),
    CONSTRAINT CK_Veiculo_Tipo CHECK (tipo IN ('MOTO','CARRO','BICICLETA','OUTRO'))
);

CREATE TABLE Entrega (
    id BIGINT PRIMARY KEY IDENTITY,
    cliente_id BIGINT NOT NULL,
    cep VARCHAR(15),
    endereco VARCHAR(200),
    complemento VARCHAR(100),
    pedido_id BIGINT NOT NULL,
    entregador_id BIGINT NULL,
    FOREIGN KEY (cliente_id) REFERENCES Cliente(id),
    FOREIGN KEY (pedido_id) REFERENCES Pedido(id),
    FOREIGN KEY (entregador_id) REFERENCES Entregador(-- =========================================
-- TABELA: FormaPagamento
-- =========================================
INSERT INTO FormaPagamento (nome, tipo) VALUES
('Visa Crédito', 'CARTAO_CREDITO'),
('Master Débito', 'CARTAO_DEBITO'),
('Ticket Restaurante', 'VALE_REFEICAO'),
('Elo Crédito', 'CARTAO_CREDITO'),
('Alelo Refeição', 'VALE_REFEICAO');

-- =========================================
-- TABELA: Usuario
-- =========================================
INSERT INTO Usuario (nome, senha, tentativasAcesso, dataBloqueio, dataInativacao, status) VALUES
('João Silva', 'senha123', 0, NULL, NULL, 'ATIVO'),
('Maria Souza', 'senha456', 2, GETDATE(), NULL, 'BLOQUEADO'),
('Carlos Pereira', 'senha789', 0, NULL, NULL, 'ATIVO'),
('Ana Lima', 'senha111', 0, NULL, GETDATE(), 'INATIVO'),
('Pedro Gomes', 'senha222', 1, NULL, NULL, 'ATIVO');

-- =========================================
-- TABELA: Permissao
-- =========================================
INSERT INTO Permissao (authority) VALUES
('ROLE_ADMIN'),
('ROLE_CLIENTE'),
('ROLE_RESTAURANTE'),
('ROLE_ENTREGADOR'),
('ROLE_FINANCEIRO');

-- =========================================
-- TABELA: Usuario_Permissao
-- =========================================
INSERT INTO Usuario_Permissao (usuario_id, authority) VALUES
(1, 'ROLE_ADMIN'),
(2, 'ROLE_CLIENTE'),
(3, 'ROLE_RESTAURANTE'),
(4, 'ROLE_ENTREGADOR'),
(5, 'ROLE_FINANCEIRO');

-- =========================================
-- TABELA: Restaurante
-- =========================================
INSERT INTO Restaurante (cnpj, nome, descricao, cep, endereco, taxaDeEntrega, tempoDeEntregaMinimo, tempoDeEntregaMaximo, aprovado, tipoDeCozinha, usuario_id) VALUES
('11111111000101','China Food','Comida chinesa','01001-000','Rua A, 123',5.50,20,40,1,'CHINESA',1),
('22222222000102','Sushi House','Comida japonesa','02002-000','Rua B, 456',7.00,30,50,1,'JAPONESA',2),
('33333333000103','Taco Loco','Comida mexicana','03003-000','Rua C, 789',8.00,25,45,0,'MEXICANA',3),
('44444444000104','Hamburgueria Top','Lanches e burgers','04004-000','Rua D, 101',6.00,15,30,1,'HAMBURGER',4),
('55555555000105','Cantina Italiana','Massas e pizzas','05005-000','Rua E, 202',10.00,35,60,0,'ITALIANA',5);

-- =========================================
-- TABELA: HorarioFuncionamento
-- =========================================
INSERT INTO HorarioFuncionamento (diaSemana, horarioAbertura, horarioFechamento, restaurante_id) VALUES
('SEGUNDA','10:00','22:00',1),
('TERCA','10:00','22:00',2),
('QUARTA','10:00','22:00',3),
('QUINTA','10:00','22:00',4),
('SEXTA','10:00','23:00',5);

-- =========================================
-- TABELA: Cardapio
-- =========================================
INSERT INTO Cardapio (restaurante_id) VALUES
(1),
(2),
(3),
(4),
(5);

-- =========================================
-- TABELA: ItemCardapio
-- =========================================
INSERT INTO ItemCardapio (nome, descricao, tipo, preco, precoPromocional, cardapio_id) VALUES
('Yakissoba','Macarrão com legumes','PRATO_PRINCIPAL',25.00,20.00,1),
('Sushi Combo','10 peças variadas','ENTRADA',30.00,25.00,2),
('Taco','Taco de carne','PRATO_PRINCIPAL',18.00,15.00,3),
('Hamburguer','Burger artesanal','PRATO_PRINCIPAL',22.00,20.00,4),
('Pizza','Pizza grande','PRATO_PRINCIPAL',45.00,40.00,5);

-- =========================================
-- TABELA: Cliente
-- =========================================
INSERT INTO Cliente (nome, cpf, email, telefone, validado) VALUES
('Lucas Almeida','123.456.789-00','lucas@email.com','11999999999',1),
('Fernanda Lima','987.654.321-00','fernanda@email.com','11888888888',0),
('Ricardo Santos','111.222.333-44','ricardo@email.com','11777777777',1),
('Juliana Costa','555.666.777-88','juliana@email.com','11666666666',0),
('Gabriel Rocha','999.888.777-66','gabriel@email.com','11555555555',1);

-- =========================================
-- TABELA: Pedido
-- =========================================
INSERT INTO Pedido (data, status, restaurante_id) VALUES
(GETDATE(),'REALIZADO',1),
(GETDATE(),'PAGO',2),
(GETDATE(),'CONFIRMADO',3),
(GETDATE(),'PRONTO',4),
(GETDATE(),'ENTREGUE',5);

-- =========================================
-- TABELA: ItemPedido
-- =========================================
INSERT INTO ItemPedido (quantidade, observacao, pedido_id, itemCardapio_id) VALUES
(2,'Sem cebola',1,1),
(1,'Com molho extra',2,2),
(3,'Bem picante',3,3),
(1,'Sem queijo',4,4),
(2,'Com borda recheada',5,5);

-- =========================================
-- TABELA: Pagamento
-- =========================================
INSERT INTO Pagamento (valor, nome, numero, expiracao, codigo, status, pedido_id, formaPagamento_id) VALUES
(50.00,'João Silva','4111111111111111','12/28','123','CRIADO',1,1),
(30.00,'Maria Souza','5500000000000004','11/27','321','CONFIRMADO',2,2),
(60.00,'Carlos Pereira','6011000000000004','10/26','111','CANCELADO',3,3),
(22.00,'Ana Lima','3530111333300000','09/25','222','CONFIRMADO',4,4),
(45.00,'Pedro Gomes','6304000000000000','08/29','333','CRIADO',5,5);

-- =========================================
-- TABELA: RestauranteFormaPagamento
-- =========================================
INSERT INTO RestauranteFormaPagamento (restaurante_id, formaPagamento_id) VALUES
(1,1),
(2,2),
(3,3),
(4,4),
(5,5);

-- =========================================
-- TABELA: Avaliacao
-- =========================================
INSERT INTO Avaliacao (nota, comentario, pedido_id) VALUES
(5,'Excelente comida!',1),
(4,'Muito bom, mas demorou.',2),
(3,'Comida razoável.',3),
(2,'Não gostei muito.',4),
(1,'Péssimo atendimento.',5);

-- =========================================
-- TABELA: Entregador
-- =========================================
INSERT INTO Entregador (nome, telefone, ativo) VALUES
('Rafael Martins','11911111111',1),
('Lucas Souza','11922222222',1),
('Paulo Oliveira','11933333333',0),
('Marcos Lima','11944444444',1),
('Thiago Santos','11955555555',0);

-- =========================================
-- TABELA: Veiculo
-- =========================================
INSERT INTO Veiculo (placa, tipo, entregador_id) VALUES
('ABC1A11','MOTO',1),
('BCD2B22','CARRO',2),
('CDE3C33','BICICLETA',3),
('DEF4D44','MOTO',4),
('EFG5E55','OUTRO',5);

-- =========================================
-- TABELA: Entrega
-- =========================================
INSERT INTO Entrega (cliente_id, cep, endereco, complemento, pedido_id, entregador_id) VALUES
(1,'01001-000','Rua A, 123','Ap 1',1,1),
(2,'02002-000','Rua B, 456','Casa',2,2),
(3,'03003-000','Rua C, 789','Fundos',3,3),
(4,'04004-000','Rua D, 101','Bloco B',4,4),
(5,'05005-000','Rua E, 202','Loja 5',5,5);


